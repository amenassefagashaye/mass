<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="·ä†·à∞·çã ·ã≤·åÇ·â≥·àç ·â¢·äï·åé ·å®·ãã·â≥ - Assefa Digital Bingo Game">
    <meta name="keywords" content="Bingo, Ethiopian Bingo, ·â¢·äï·åé, ·ä¢·âµ·ãÆ·åµ·ã´, Game, Online, Multiplayer">
    <meta name="author" content="Assefa Digital Bingo">
    <meta property="og:title" content="·ä†·à∞·çã ·ã≤·åÇ·â≥·àç ·â¢·äï·åé">
    <meta property="og:description" content="Real-time multiplayer Bingo game with Ethiopian style">
    <meta property="og:image" content="https://ameng-gogs-mass2-81.deno.dev/logo.png">
    <meta property="og:url" content="https://ameng-gogs-mass2-81.deno.dev">
    
    <title>·ä†·à∞·çã ·ã≤·åÇ·â≥·àç ·â¢·äï·åé | Assefa Digital Bingo</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üéÆ</text></svg>">
    
    <!-- Fonts -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Ethiopic:wght@400;500;600;700&family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <!-- Styles -->
    <style>
        /* ===== GLOBAL STYLES ===== */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
        }

        html, body {
            width: 100%;
            height: 100%;
            overflow: hidden;
            font-family: 'Roboto', 'Noto Sans Ethiopic', 'Arial', sans-serif;
            background: linear-gradient(135deg, #1a237e 0%, #0d47a1 50%, #1565c0 100%);
            color: white;
            touch-action: manipulation;
            position: fixed;
        }

        .amharic {
            font-family: 'Noto Sans Ethiopic', 'Roboto', sans-serif;
        }

        .english {
            font-family: 'Roboto', 'Noto Sans Ethiopic', sans-serif;
        }

        /* ===== LOADING SCREEN ===== */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #1a237e 0%, #0d47a1 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            transition: opacity 0.5s ease;
        }

        .loading-screen.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .loading-logo {
            font-size: 4rem;
            margin-bottom: 2rem;
            animation: bounce 2s infinite;
        }

        .loading-title {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            text-align: center;
        }

        .loading-subtitle {
            font-size: 1.2rem;
            opacity: 0.8;
            margin-bottom: 2rem;
            text-align: center;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 5px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s linear infinite;
            margin-bottom: 2rem;
        }

        .loading-progress {
            width: 200px;
            height: 4px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 2px;
            overflow: hidden;
        }

        .loading-progress-bar {
            height: 100%;
            background: #4CAF50;
            width: 0%;
            transition: width 0.3s ease;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }

        /* ===== MAIN CONTAINER ===== */
        .app-container {
            width: 100%;
            height: 100%;
            display: none;
            flex-direction: column;
            background: rgba(0, 0, 0, 0.7);
        }

        .app-container.active {
            display: flex;
        }

        /* ===== HEADER ===== */
        .app-header {
            background: rgba(0, 0, 0, 0.8);
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid #4CAF50;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
            position: relative;
            z-index: 100;
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo {
            font-size: 2rem;
        }

        .game-title h1 {
            font-size: 1.5rem;
            font-weight: 700;
        }

        .game-title .subtitle {
            font-size: 0.9rem;
            opacity: 0.8;
        }

        .header-controls {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .connection-status {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            font-size: 0.9rem;
        }

        .status-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #f44336;
        }

        .status-indicator.connected {
            background: #4CAF50;
            animation: pulse 2s infinite;
        }

        .status-indicator.connecting {
            background: #FF9800;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .player-info {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
        }

        .player-avatar {
            width: 30px;
            height: 30px;
            background: #4CAF50;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .balance-display {
            display: flex;
            align-items: center;
            gap: 5px;
            background: rgba(76, 175, 80, 0.2);
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: bold;
        }

        .balance-amount {
            color: #4CAF50;
        }

        /* ===== MAIN CONTENT ===== */
        .main-content {
            flex: 1;
            display: flex;
            overflow: hidden;
            position: relative;
        }

        /* ===== LEFT PANEL - Game Board ===== */
        .game-board-container {
            flex: 3;
            display: flex;
            flex-direction: column;
            padding: 20px;
            background: rgba(0, 0, 0, 0.5);
        }

        .room-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }

        .room-id {
            font-size: 1.2rem;
            font-weight: bold;
            color: #4CAF50;
        }

        .room-stats {
            display: flex;
            gap: 20px;
        }

        .stat {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .stat-value {
            font-size: 1.2rem;
            font-weight: bold;
            color: #FF9800;
        }

        .stat-label {
            font-size: 0.8rem;
            opacity: 0.8;
        }

        .bingo-card {
            flex: 1;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            overflow: auto;
        }

        .card-header {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
        }

        .card-header .letter {
            width: 50px;
            height: 50px;
            background: #2196F3;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: bold;
            color: white;
        }

        .card-row {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .card-cell {
            width: 60px;
            height: 60px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .card-cell:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.05);
        }

        .card-cell.marked {
            background: #4CAF50;
            color: white;
        }

        .card-cell.marked::after {
            content: '‚úì';
            position: absolute;
            top: 5px;
            right: 5px;
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.8);
        }

        .card-cell.called {
            background: #FF9800;
            color: white;
        }

        /* ===== RIGHT PANEL - Controls & Info ===== */
        .right-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 20px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.7);
            border-left: 2px solid rgba(255, 255, 255, 0.1);
            min-width: 300px;
        }

        /* Called Numbers */
        .called-numbers-container {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
        }

        .section-title {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            color: #2196F3;
            font-size: 1.1rem;
        }

        .section-title i {
            font-size: 1.2rem;
        }

        .called-numbers-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 8px;
            max-height: 200px;
            overflow-y: auto;
            padding: 10px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
        }

        .called-number {
            width: 40px;
            height: 40px;
            background: #2196F3;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.9rem;
            margin: 0 auto;
        }

        .called-number.latest {
            background: #FF9800;
            animation: pop 0.5s ease;
        }

        @keyframes pop {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        /* Players List */
        .players-container {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            flex: 1;
            min-height: 200px;
        }

        .players-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
            max-height: 200px;
            overflow-y: auto;
            padding: 10px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
        }

        .player-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            transition: background 0.3s ease;
        }

        .player-item:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .player-avatar-small {
            width: 30px;
            height: 30px;
            background: #4CAF50;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .player-details {
            flex: 1;
        }

        .player-name {
            font-weight: 500;
            font-size: 0.9rem;
        }

        .player-stake {
            font-size: 0.8rem;
            opacity: 0.8;
            color: #FF9800;
        }

        /* Game Controls */
        .game-controls {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
        }

        .control-buttons {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        .btn {
            padding: 12px 15px;
            border: none;
            border-radius: 10px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-primary {
            background: #4CAF50;
            color: white;
        }

        .btn-primary:hover {
            background: #45a049;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(76, 175, 80, 0.4);
        }

        .btn-secondary {
            background: #2196F3;
            color: white;
        }

        .btn-secondary:hover {
            background: #1976D2;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(33, 150, 243, 0.4);
        }

        .btn-danger {
            background: #f44336;
            color: white;
        }

        .btn-danger:hover {
            background: #d32f2f;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(244, 67, 54, 0.4);
        }

        .btn-warning {
            background: #FF9800;
            color: white;
        }

        .btn-warning:hover {
            background: #F57C00;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255, 152, 0, 0.4);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
            box-shadow: none !important;
        }

        /* ===== MODALS ===== */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .modal.active {
            opacity: 1;
            pointer-events: all;
        }

        .modal-content {
            background: linear-gradient(135deg, #1a237e 0%, #0d47a1 100%);
            border-radius: 20px;
            padding: 30px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            animation: modalSlide 0.3s ease;
            border: 2px solid #4CAF50;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
        }

        @keyframes modalSlide {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 1.5rem;
            color: white;
        }

        .modal-close {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background 0.3s ease;
        }

        .modal-close:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            color: rgba(255, 255, 255, 0.9);
            font-weight: 500;
        }

        .form-input {
            width: 100%;
            padding: 12px 15px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            color: white;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: #4CAF50;
            background: rgba(255, 255, 255, 0.15);
        }

        .form-input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .form-actions {
            display: flex;
            gap: 10px;
            margin-top: 30px;
        }

        .form-actions .btn {
            flex: 1;
        }

        /* ===== REGISTRATION MODAL ===== */
        .registration-steps {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
            position: relative;
        }

        .registration-steps::before {
            content: '';
            position: absolute;
            top: 15px;
            left: 0;
            right: 0;
            height: 2px;
            background: rgba(255, 255, 255, 0.2);
            z-index: 1;
        }

        .step {
            width: 30px;
            height: 30px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            position: relative;
            z-index: 2;
            transition: all 0.3s ease;
        }

        .step.active {
            background: #4CAF50;
            transform: scale(1.2);
        }

        .step.completed {
            background: #2196F3;
        }

        .step-label {
            position: absolute;
            top: 35px;
            left: 50%;
            transform: translateX(-50%);
            white-space: nowrap;
            font-size: 0.8rem;
            opacity: 0.8;
        }

        /* ===== CHAT MODAL ===== */
        .chat-container {
            height: 400px;
            display: flex;
            flex-direction: column;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            margin-bottom: 15px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .chat-message {
            padding: 10px 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            max-width: 80%;
            word-wrap: break-word;
        }

        .chat-message.self {
            align-self: flex-end;
            background: #4CAF50;
        }

        .chat-message.admin {
            background: #FF9800;
        }

        .chat-input-container {
            display: flex;
            gap: 10px;
        }

        /* ===== NOTIFICATIONS ===== */
        .notifications-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            gap: 10px;
            max-width: 300px;
        }

        .notification {
            padding: 15px 20px;
            background: rgba(0, 0, 0, 0.9);
            border-radius: 10px;
            border-left: 4px solid #4CAF50;
            display: flex;
            align-items: center;
            gap: 10px;
            animation: slideIn 0.3s ease;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .notification.error {
            border-left-color: #f44336;
        }

        .notification.warning {
            border-left-color: #FF9800;
        }

        .notification.info {
            border-left-color: #2196F3;
        }

        .notification-icon {
            font-size: 1.2rem;
        }

        .notification-text {
            flex: 1;
            font-size: 0.9rem;
        }

        .notification-close {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            font-size: 1rem;
            opacity: 0.7;
            transition: opacity 0.3s ease;
        }

        .notification-close:hover {
            opacity: 1;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(100%);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        /* ===== RESPONSIVE DESIGN ===== */
        @media (max-width: 1024px) {
            .main-content {
                flex-direction: column;
            }
            
            .right-panel {
                min-width: unset;
                border-left: none;
                border-top: 2px solid rgba(255, 255, 255, 0.1);
            }
            
            .card-cell {
                width: 50px;
                height: 50px;
                font-size: 1rem;
            }
        }

        @media (max-width: 768px) {
            .app-header {
                flex-direction: column;
                gap: 10px;
                padding: 10px;
            }
            
            .logo-section {
                width: 100%;
                justify-content: center;
            }
            
            .header-controls {
                width: 100%;
                justify-content: center;
                flex-wrap: wrap;
            }
            
            .connection-status, .player-info, .balance-display {
                font-size: 0.8rem;
                padding: 6px 12px;
            }
            
            .game-title h1 {
                font-size: 1.2rem;
            }
            
            .room-info {
                flex-direction: column;
                gap: 10px;
                text-align: center;
            }
            
            .room-stats {
                justify-content: center;
            }
            
            .control-buttons {
                grid-template-columns: 1fr;
            }
            
            .modal-content {
                width: 95%;
                padding: 20px;
            }
        }

        @media (max-width: 480px) {
            .card-header .letter {
                width: 40px;
                height: 40px;
                font-size: 1.2rem;
            }
            
            .card-cell {
                width: 40px;
                height: 40px;
                font-size: 0.9rem;
            }
            
            .called-number {
                width: 30px;
                height: 30px;
                font-size: 0.8rem;
            }
            
            .btn {
                padding: 10px;
                font-size: 0.8rem;
            }
        }

        /* ===== UTILITY CLASSES ===== */
        .hidden {
            display: none !important;
        }

        .text-center {
            text-align: center;
        }

        .text-success {
            color: #4CAF50 !important;
        }

        .text-warning {
            color: #FF9800 !important;
        }

        .text-danger {
            color: #f44336 !important;
        }

        .text-info {
            color: #2196F3 !important;
        }

        .mb-10 {
            margin-bottom: 10px;
        }

        .mb-20 {
            margin-bottom: 20px;
        }

        .mt-10 {
            margin-top: 10px;
        }

        .mt-20 {
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div id="loadingScreen" class="loading-screen">
        <div class="loading-logo">üéÆ</div>
        <h1 class="loading-title amharic">·ä†·à∞·çã ·ã≤·åÇ·â≥·àç ·â¢·äï·åé</h1>
        <div class="loading-subtitle english">Assefa Digital Bingo - Multiplayer Game</div>
        <div class="loading-spinner"></div>
        <div class="loading-progress">
            <div id="loadingProgress" class="loading-progress-bar"></div>
        </div>
        <div id="loadingMessage" class="loading-subtitle mt-10">Initializing game...</div>
    </div>

    <!-- Main App Container -->
    <div id="appContainer" class="app-container">
        <!-- Header -->
        <header class="app-header">
            <div class="logo-section">
                <div class="logo">üéÆ</div>
                <div class="game-title">
                    <h1 class="amharic">·ä†·à∞·çã ·ã≤·åÇ·â≥·àç ·â¢·äï·åé</h1>
                    <div class="subtitle english">Real-time Multiplayer Bingo</div>
                </div>
            </div>
            
            <div class="header-controls">
                <div id="connectionStatus" class="connection-status">
                    <div id="statusIndicator" class="status-indicator"></div>
                    <span id="statusText">Connecting...</span>
                </div>
                
                <div id="playerInfo" class="player-info hidden">
                    <div id="playerAvatar" class="player-avatar">?</div>
                    <span id="playerName">Player</span>
                </div>
                
                <div id="balanceInfo" class="balance-display hidden">
                    <i class="fas fa-coins"></i>
                    <span>Balance: </span>
                    <span id="balanceAmount" class="balance-amount">0</span>
                    <span>·â•·à≠</span>
                </div>
                
                <button id="settingsBtn" class="btn btn-secondary" style="padding: 8px 15px;">
                    <i class="fas fa-cog"></i>
                </button>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Left Panel - Game Board -->
            <section class="game-board-container">
                <div id="roomInfo" class="room-info hidden">
                    <div>
                        <span class="english">Room: </span>
                        <span id="roomId" class="room-id amharic">Not Joined</span>
                    </div>
                    <div class="room-stats">
                        <div class="stat">
                            <span id="playerCount" class="stat-value">0</span>
                            <span class="stat-label english">Players</span>
                        </div>
                        <div class="stat">
                            <span id="gameType" class="stat-value">75</span>
                            <span class="stat-label english">Ball</span>
                        </div>
                        <div class="stat">
                            <span id="stakeAmount" class="stat-value">25</span>
                            <span class="stat-label english">Stake</span>
                        </div>
                    </div>
                </div>
                
                <div id="bingoCard" class="bingo-card">
                    <!-- Bingo card will be generated dynamically -->
                    <div class="text-center english" style="margin: auto; opacity: 0.7;">
                        <i class="fas fa-dice mb-20" style="font-size: 3rem;"></i>
                        <h3>Join a room to start playing!</h3>
                        <p>Select a game type and stake amount to begin.</p>
                    </div>
                </div>
            </section>

            <!-- Right Panel - Controls & Info -->
            <aside class="right-panel">
                <!-- Called Numbers -->
                <div class="called-numbers-container">
                    <div class="section-title">
                        <i class="fas fa-bullhorn"></i>
                        <span class="english">Called Numbers</span>
                    </div>
                    <div id="calledNumbers" class="called-numbers-grid">
                        <!-- Called numbers will appear here -->
                        <div class="called-number latest">75</div>
                        <div class="called-number">42</div>
                        <div class="called-number">18</div>
                    </div>
                </div>

                <!-- Players List -->
                <div class="players-container">
                    <div class="section-title">
                        <i class="fas fa-users"></i>
                        <span class="english">Players in Room</span>
                        <span id="playersCount" class="text-warning" style="margin-left: auto;">(0)</span>
                    </div>
                    <div id="playersList" class="players-list">
                        <div class="text-center" style="opacity: 0.7; padding: 20px;">
                            <i class="fas fa-user-friends" style="font-size: 2rem; margin-bottom: 10px;"></i>
                            <p>No players in room yet</p>
                        </div>
                    </div>
                </div>

                <!-- Game Controls -->
                <div class="game-controls">
                    <div class="section-title">
                        <i class="fas fa-gamepad"></i>
                        <span class="english">Game Controls</span>
                    </div>
                    <div class="control-buttons">
                        <button id="joinRoomBtn" class="btn btn-primary">
                            <i class="fas fa-door-open"></i>
                            <span>Join Room</span>
                        </button>
                        <button id="createRoomBtn" class="btn btn-secondary">
                            <i class="fas fa-plus-circle"></i>
                            <span>Create Room</span>
                        </button>
                        <button id="claimWinBtn" class="btn btn-warning" disabled>
                            <i class="fas fa-trophy"></i>
                            <span>Claim Win</span>
                        </button>
                        <button id="chatBtn" class="btn btn-info">
                            <i class="fas fa-comments"></i>
                            <span>Chat</span>
                        </button>
                        <button id="adminPanelBtn" class="btn btn-danger hidden">
                            <i class="fas fa-user-shield"></i>
                            <span>Admin</span>
                        </button>
                        <button id="leaveRoomBtn" class="btn btn-danger" disabled>
                            <i class="fas fa-sign-out-alt"></i>
                            <span>Leave</span>
                        </button>
                    </div>
                </div>
            </aside>
        </main>
    </div>

    <!-- Modals -->
    
    <!-- Registration Modal -->
    <div id="registrationModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title english">Player Registration</h2>
                <button class="modal-close" onclick="closeModal('registrationModal')">&times;</button>
            </div>
            
            <div class="registration-steps">
                <div class="step active" id="step1">
                    <span>1</span>
                    <div class="step-label english">Info</div>
                </div>
                <div class="step" id="step2">
                    <span>2</span>
                    <div class="step-label english">Game</div>
                </div>
                <div class="step" id="step3">
                    <span>3</span>
                    <div class="step-label english">Confirm</div>
                </div>
            </div>
            
            <form id="registrationForm">
                <!-- Step 1: Personal Information -->
                <div id="step1Content" class="step-content">
                    <div class="form-group">
                        <label class="form-label english">Full Name</label>
                        <input type="text" id="playerNameInput" class="form-input" 
                               placeholder="Enter your name" required 
                               minlength="2" maxlength="30">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label english">Phone Number</label>
                        <input type="tel" id="playerPhoneInput" class="form-input" 
                               placeholder="0912345678" required
                               pattern="^(\+251|251|0)?9\d{8}$">
                        <small class="english" style="display: block; margin-top: 5px; opacity: 0.7;">
                            Enter Ethiopian phone number (e.g., 0912345678)
                        </small>
                    </div>
                </div>
                
                <!-- Step 2: Game Preferences -->
                <div id="step2Content" class="step-content hidden">
                    <div class="form-group">
                        <label class="form-label english">Game Type</label>
                        <select id="gameTypeSelect" class="form-input" required>
                            <option value="75ball">75 Ball Bingo</option>
                            <option value="90ball">90 Ball Bingo</option>
                            <option value="bingo75">Ethiopian Bingo 75</option>
                            <option value="bingo90">Ethiopian Bingo 90</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label english">Stake Amount (·â•·à≠)</label>
                        <select id="stakeSelect" class="form-input" required>
                            <option value="5">5 ·â•·à≠</option>
                            <option value="10">10 ·â•·à≠</option>
                            <option value="25" selected>25 ·â•·à≠</option>
                            <option value="50">50 ·â•·à≠</option>
                            <option value="100">100 ·â•·à≠</option>
                            <option value="200">200 ·â•·à≠</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label english">Initial Payment (Optional)</label>
                        <input type="number" id="initialPayment" class="form-input" 
                               placeholder="0" min="0" max="10000" step="10">
                    </div>
                </div>
                
                <!-- Step 3: Confirmation -->
                <div id="step3Content" class="step-content hidden">
                    <div class="text-center mb-20">
                        <i class="fas fa-user-check" style="font-size: 3rem; color: #4CAF50;"></i>
                        <h3 class="mt-10 english">Review Your Information</h3>
                    </div>
                    
                    <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px;">
                        <div class="form-group">
                            <strong class="english">Name:</strong>
                            <span id="reviewName" class="text-success"></span>
                        </div>
                        <div class="form-group">
                            <strong class="english">Phone:</strong>
                            <span id="reviewPhone" class="text-success"></span>
                        </div>
                        <div class="form-group">
                            <strong class="english">Game Type:</strong>
                            <span id="reviewGameType" class="text-success"></span>
                        </div>
                        <div class="form-group">
                            <strong class="english">Stake:</strong>
                            <span id="reviewStake" class="text-success"></span>
                        </div>
                        <div class="form-group">
                            <strong class="english">Initial Payment:</strong>
                            <span id="reviewPayment" class="text-success">0 ·â•·à≠</span>
                        </div>
                    </div>
                    
                    <div class="form-group mt-20">
                        <label class="form-label">
                            <input type="checkbox" id="termsCheckbox" required>
                            <span class="english">I agree to the terms and conditions</span>
                        </label>
                    </div>
                </div>
                
                <div class="form-actions">
                    <button type="button" id="prevStepBtn" class="btn btn-secondary" style="display: none;">
                        <i class="fas fa-arrow-left"></i>
                        <span>Previous</span>
                    </button>
                    <button type="button" id="nextStepBtn" class="btn btn-primary">
                        <span>Next</span>
                        <i class="fas fa-arrow-right"></i>
                    </button>
                    <button type="submit" id="submitRegistrationBtn" class="btn btn-success" style="display: none;">
                        <i class="fas fa-check"></i>
                        <span>Complete Registration</span>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Join Room Modal -->
    <div id="joinRoomModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title english">Join Room</h2>
                <button class="modal-close" onclick="closeModal('joinRoomModal')">&times;</button>
            </div>
            
            <div class="form-group">
                <label class="form-label english">Room ID</label>
                <input type="text" id="roomIdInput" class="form-input" 
                       placeholder="Enter room code (e.g., BINGO01)" 
                       maxlength="8" style="text-transform: uppercase;">
            </div>
            
            <div class="form-group">
                <label class="form-label english">Or Select from Available Rooms</label>
                <div id="availableRooms" class="players-list" style="max-height: 150px;">
                    <!-- Rooms will be populated here -->
                    <div class="text-center" style="opacity: 0.7; padding: 20px;">
                        <i class="fas fa-door-closed" style="font-size: 2rem;"></i>
                        <p>No available rooms</p>
                    </div>
                </div>
            </div>
            
            <div class="form-actions">
                <button type="button" class="btn btn-secondary" onclick="closeModal('joinRoomModal')">
                    Cancel
                </button>
                <button type="button" id="confirmJoinBtn" class="btn btn-primary">
                    <i class="fas fa-sign-in-alt"></i>
                    <span>Join Room</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Create Room Modal -->
    <div id="createRoomModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title english">Create New Room</h2>
                <button class="modal-close" onclick="closeModal('createRoomModal')">&times;</button>
            </div>
            
            <div class="form-group">
                <label class="form-label english">Room Name</label>
                <input type="text" id="newRoomName" class="form-input" 
                       placeholder="Enter room name" maxlength="20">
            </div>
            
            <div class="form-group">
                <label class="form-label english">Game Type</label>
                <select id="newGameType" class="form-input">
                    <option value="75ball">75 Ball Bingo</option>
                    <option value="90ball">90 Ball Bingo</option>
                    <option value="bingo75">Ethiopian Bingo 75</option>
                    <option value="bingo90">Ethiopian Bingo 90</option>
                </select>
            </div>
            
            <div class="form-group">
                <label class="form-label english">Stake Amount (·â•·à≠)</label>
                <select id="newStakeAmount" class="form-input">
                    <option value="5">5 ·â•·à≠</option>
                    <option value="10">10 ·â•·à≠</option>
                    <option value="25" selected>25 ·â•·à≠</option>
                    <option value="50">50 ·â•·à≠</option>
                    <option value="100">100 ·â•·à≠</option>
                    <option value="200">200 ·â•·à≠</option>
                </select>
            </div>
            
            <div class="form-group">
                <label class="form-label english">Max Players</label>
                <input type="range" id="maxPlayers" class="form-input" 
                       min="2" max="50" value="20">
                <div style="display: flex; justify-content: space-between;">
                    <span>2</span>
                    <span id="maxPlayersValue">20 Players</span>
                    <span>50</span>
                </div>
            </div>
            
            <div class="form-actions">
                <button type="button" class="btn btn-secondary" onclick="closeModal('createRoomModal')">
                    Cancel
                </button>
                <button type="button" id="confirmCreateBtn" class="btn btn-primary">
                    <i class="fas fa-plus-circle"></i>
                    <span>Create Room</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Chat Modal -->
    <div id="chatModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title english">
                    <i class="fas fa-comments"></i>
                    Chat Room
                </h2>
                <button class="modal-close" onclick="closeModal('chatModal')">&times;</button>
            </div>
            
            <div class="chat-container">
                <div id="chatMessages" class="chat-messages">
                    <!-- Chat messages will appear here -->
                    <div class="text-center" style="margin: auto; opacity: 0.7;">
                        <i class="fas fa-comment-slash" style="font-size: 3rem;"></i>
                        <p>No messages yet. Start the conversation!</p>
                    </div>
                </div>
                
                <div class="chat-input-container">
                    <input type="text" id="chatInput" class="form-input" 
                           placeholder="Type your message..." maxlength="200">
                    <button id="sendChatBtn" class="btn btn-primary">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Admin Panel Modal -->
    <div id="adminModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title english">
                    <i class="fas fa-user-shield"></i>
                    Admin Panel
                </h2>
                <button class="modal-close" onclick="closeModal('adminModal')">&times;</button>
            </div>
            
            <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                <button id="adminStatsBtn" class="btn btn-info">
                    <i class="fas fa-chart-bar"></i>
                    <span>Stats</span>
                </button>
                <button id="adminBroadcastBtn" class="btn btn-warning">
                    <i class="fas fa-bullhorn"></i>
                    <span>Broadcast</span>
                </button>
                <button id="adminCallNumberBtn" class="btn btn-primary">
                    <i class="fas fa-volume-up"></i>
                    <span>Call Number</span>
                </button>
            </div>
            
            <div id="adminContent">
                <!-- Admin content will be loaded here -->
                <div class="text-center" style="opacity: 0.7; padding: 50px 0;">
                    <i class="fas fa-user-shield" style="font-size: 3rem; margin-bottom: 20px;"></i>
                    <h3>Admin Controls</h3>
                    <p>Select an action from above</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Notifications Container -->
    <div id="notifications" class="notifications-container"></div>

    <!-- JavaScript Modules -->
    <script type="module">
        // Import configuration and WebSocket module
        import config from './config.js';
        import WebSocketModule from './websocket.js';
        
        // Global state
        const gameState = {
            playerId: null,
            playerName: '',
            isAdmin: false,
            balance: 0,
            roomId: null,
            gameActive: false,
            currentStep: 1
        };
        
        // DOM Elements
        const elements = {
            loadingScreen: document.getElementById('loadingScreen'),
            appContainer: document.getElementById('appContainer'),
            statusIndicator: document.getElementById('statusIndicator'),
            statusText: document.getElementById('statusText'),
            playerInfo: document.getElementById('playerInfo'),
            playerAvatar: document.getElementById('playerAvatar'),
            playerName: document.getElementById('playerName'),
            balanceInfo: document.getElementById('balanceInfo'),
            balanceAmount: document.getElementById('balanceAmount'),
            roomInfo: document.getElementById('roomInfo'),
            roomId: document.getElementById('roomId'),
            playerCount: document.getElementById('playerCount'),
            gameType: document.getElementById('gameType'),
            stakeAmount: document.getElementById('stakeAmount'),
            bingoCard: document.getElementById('bingoCard'),
            calledNumbers: document.getElementById('calledNumbers'),
            playersList: document.getElementById('playersList'),
            playersCount: document.getElementById('playersCount'),
            
            // Buttons
            joinRoomBtn: document.getElementById('joinRoomBtn'),
            createRoomBtn: document.getElementById('createRoomBtn'),
            claimWinBtn: document.getElementById('claimWinBtn'),
            chatBtn: document.getElementById('chatBtn'),
            adminPanelBtn: document.getElementById('adminPanelBtn'),
            leaveRoomBtn: document.getElementById('leaveRoomBtn'),
            settingsBtn: document.getElementById('settingsBtn'),
            
            // Modals
            registrationModal: document.getElementById('registrationModal'),
            joinRoomModal: document.getElementById('joinRoomModal'),
            createRoomModal: document.getElementById('createRoomModal'),
            chatModal: document.getElementById('chatModal'),
            adminModal: document.getElementById('adminModal'),
            
            // Form elements
            playerNameInput: document.getElementById('playerNameInput'),
            playerPhoneInput: document.getElementById('playerPhoneInput'),
            gameTypeSelect: document.getElementById('gameTypeSelect'),
            stakeSelect: document.getElementById('stakeSelect'),
            initialPayment: document.getElementById('initialPayment'),
            termsCheckbox: document.getElementById('termsCheckbox'),
            roomIdInput: document.getElementById('roomIdInput'),
            availableRooms: document.getElementById('availableRooms'),
            confirmJoinBtn: document.getElementById('confirmJoinBtn'),
            newRoomName: document.getElementById('newRoomName'),
            newGameType: document.getElementById('newGameType'),
            newStakeAmount: document.getElementById('newStakeAmount'),
            maxPlayers: document.getElementById('maxPlayers'),
            maxPlayersValue: document.getElementById('maxPlayersValue'),
            confirmCreateBtn: document.getElementById('confirmCreateBtn'),
            chatInput: document.getElementById('chatInput'),
            sendChatBtn: document.getElementById('sendChatBtn'),
            chatMessages: document.getElementById('chatMessages'),
            
            // Registration steps
            step1: document.getElementById('step1'),
            step2: document.getElementById('step2'),
            step3: document.getElementById('step3'),
            step1Content: document.getElementById('step1Content'),
            step2Content: document.getElementById('step2Content'),
            step3Content: document.getElementById('step3Content'),
            prevStepBtn: document.getElementById('prevStepBtn'),
            nextStepBtn: document.getElementById('nextStepBtn'),
            submitRegistrationBtn: document.getElementById('submitRegistrationBtn'),
            
            // Admin
            adminContent: document.getElementById('adminContent'),
            adminStatsBtn: document.getElementById('adminStatsBtn'),
            adminBroadcastBtn: document.getElementById('adminBroadcastBtn'),
            adminCallNumberBtn: document.getElementById('adminCallNumberBtn')
        };
        
        // Initialize loading
        let loadingProgress = 0;
        const loadingInterval = setInterval(() => {
            loadingProgress += Math.random() * 10;
            if (loadingProgress > 100) loadingProgress = 100;
            document.getElementById('loadingProgress').style.width = loadingProgress + '%';
            
            if (loadingProgress >= 100) {
                clearInterval(loadingInterval);
                setTimeout(initApp, 500);
            }
        }, 100);
        
        // Application initialization
        async function initApp() {
            try {
                console.log('üöÄ Initializing Bingo Game...');
                updateLoadingMessage('Connecting to server...');
                
                // Initialize WebSocket connection
                const connected = await WebSocketModule.initialize();
                
                if (connected) {
                    // Hide loading screen, show app
                    elements.loadingScreen.classList.add('hidden');
                    elements.appContainer.classList.add('active');
                    
                    // Check if player is already registered
                    const savedPlayerId = localStorage.getItem('bingo_player_id');
                    if (savedPlayerId) {
                        // Auto-login with saved ID
                        gameState.playerId = savedPlayerId;
                        gameState.playerName = localStorage.getItem('bingo_player_name') || '';
                        gameState.balance = parseInt(localStorage.getItem('bingo_balance')) || 0;
                        
                        updatePlayerUI();
                        showNotification('Welcome back, ' + gameState.playerName + '!', 'info');
                    } else {
                        // Show registration modal
                        setTimeout(() => openModal('registrationModal'), 500);
                    }
                    
                    setupEventListeners();
                    setupWebSocketListeners();
                    
                    console.log('‚úÖ Application initialized successfully');
                    updateLoadingMessage('Ready!');
                } else {
                    updateLoadingMessage('Failed to connect to server. Retrying...');
                    setTimeout(initApp, 2000);
                }
            } catch (error) {
                console.error('‚ùå Initialization failed:', error);
                updateLoadingMessage('Error: ' + error.message);
                showNotification('Failed to initialize application', 'error');
            }
        }
        
        // Setup event listeners
        function setupEventListeners() {
            // Registration form
            elements.nextStepBtn.addEventListener('click', nextRegistrationStep);
            elements.prevStepBtn.addEventListener('click', prevRegistrationStep);
            elements.submitRegistrationBtn.addEventListener('click', submitRegistration);
            elements.playerNameInput.addEventListener('input', validateStep1);
            elements.playerPhoneInput.addEventListener('input', validateStep1);
            
            // Game buttons
            elements.joinRoomBtn.addEventListener('click', () => openModal('joinRoomModal'));
            elements.createRoomBtn.addEventListener('click', () => openModal('createRoomModal'));
            elements.claimWinBtn.addEventListener('click', claimWin);
            elements.chatBtn.addEventListener('click', () => openModal('chatModal'));
            elements.leaveRoomBtn.addEventListener('click', leaveRoom);
            elements.settingsBtn.addEventListener('click', showSettings);
            
            // Join room
            elements.confirmJoinBtn.addEventListener('click', joinRoom);
            elements.roomIdInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') joinRoom();
            });
            
            // Create room
            elements.confirmCreateBtn.addEventListener('click', createRoom);
            elements.maxPlayers.addEventListener('input', (e) => {
                elements.maxPlayersValue.textContent = e.target.value + ' Players';
            });
            
            // Chat
            elements.sendChatBtn.addEventListener('click', sendChatMessage);
            elements.chatInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') sendChatMessage();
            });
            
            // Admin
            elements.adminStatsBtn.addEventListener('click', showAdminStats);
            elements.adminBroadcastBtn.addEventListener('click', showAdminBroadcast);
            elements.adminCallNumberBtn.addEventListener('click', showAdminCallNumber);
            
            // Modal close on escape
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    closeAllModals();
                }
            });
            
            // Prevent form submission
            document.querySelectorAll('form').forEach(form => {
                form.addEventListener('submit', (e) => e.preventDefault());
            });
        }
        
        // Setup WebSocket event listeners
        function setupWebSocketListeners() {
            WebSocketModule.on('connection_status', (data) => {
                updateConnectionStatus(data.status);
            });
            
            WebSocketModule.on('auth_success', (data) => {
                gameState.playerId = data.playerId;
                gameState.isAdmin = data.isAdmin || false;
                
                if (data.isAdmin) {
                    elements.adminPanelBtn.classList.remove('hidden');
                }
                
                showNotification('Connected to game server', 'success');
            });
            
            WebSocketModule.on('registration_success', (data) => {
                gameState.playerId = data.playerId;
                gameState.playerName = data.name;
                gameState.balance = data.balance || 0;
                
                // Save to localStorage
                localStorage.setItem('bingo_player_id', data.playerId);
                localStorage.setItem('bingo_player_name', data.name);
                localStorage.setItem('bingo_balance', data.balance);
                
                updatePlayerUI();
                closeModal('registrationModal');
                showNotification('Registration successful! Welcome ' + data.name, 'success');
            });
            
            WebSocketModule.on('room_joined', (data) => {
                gameState.roomId = data.roomId;
                updateRoomUI(data);
                generateBingoCard(data.gameType);
                showNotification(`Joined room: ${data.roomId}`, 'info');
            });
            
            WebSocketModule.on('room_update', (data) => {
                updatePlayersList(data.players);
            });
            
            WebSocketModule.on('game_started', (data) => {
                gameState.gameActive = true;
                elements.claimWinBtn.disabled = false;
                showNotification('Game started! Good luck!', 'info');
            });
            
            WebSocketModule.on('number_called', (data) => {
                addCalledNumber(data.number);
                updateBingoCard(data.number);
            });
            
            WebSocketModule.on('player_joined', (data) => {
                showNotification(`${data.name} joined the room`, 'info');
            });
            
            WebSocketModule.on('player_left', (data) => {
                showNotification(`${data.name} left the room`, 'warning');
            });
            
            WebSocketModule.on('win_announced', (data) => {
                showNotification(`üéâ ${data.winnerName} won ${data.amount} ETB!`, 'success');
                if (data.winnerId === gameState.playerId) {
                    gameState.balance = data.newBalance;
                    updatePlayerUI();
                }
            });
            
            WebSocketModule.on('payment_processed', (data) => {
                gameState.balance = data.newBalance;
                updatePlayerUI();
                showNotification(`Payment of ${data.amount} ETB processed`, 'success');
            });
            
            WebSocketModule.on('chat_message', (data) => {
                addChatMessage(data.playerName, data.text, data.isAdmin);
            });
            
            WebSocketModule.on('error', (data) => {
                showNotification(data.message || 'An error occurred', 'error');
            });
        }
        
        // UI Update Functions
        function updateConnectionStatus(status) {
            elements.statusIndicator.className = 'status-indicator ' + status;
            elements.statusText.textContent = status.charAt(0).toUpperCase() + status.slice(1);
        }
        
        function updatePlayerUI() {
            elements.playerInfo.classList.remove('hidden');
            elements.balanceInfo.classList.remove('hidden');
            
            elements.playerAvatar.textContent = gameState.playerName.charAt(0).toUpperCase();
            elements.playerName.textContent = gameState.playerName;
            elements.balanceAmount.textContent = gameState.balance.toLocaleString();
        }
        
        function updateRoomUI(data) {
            elements.roomInfo.classList.remove('hidden');
            elements.leaveRoomBtn.disabled = false;
            
            elements.roomId.textContent = data.roomId;
            elements.gameType.textContent = data.gameType.replace('ball', '').replace('bingo', '');
            elements.stakeAmount.textContent = data.stake;
            
            if (data.players) {
                updatePlayersList(data.players);
            }
        }
        
        function updatePlayersList(players) {
            elements.playersList.innerHTML = '';
            elements.playerCount.textContent = players.length;
            elements.playersCount.textContent = `(${players.length})`;
            
            if (players.length === 0) {
                elements.playersList.innerHTML = `
                    <div class="text-center" style="opacity: 0.7; padding: 20px;">
                        <i class="fas fa-user-friends" style="font-size: 2rem; margin-bottom: 10px;"></i>
                        <p>No players in room yet</p>
                    </div>
                `;
                return;
            }
            
            players.forEach(player => {
                const playerEl = document.createElement('div');
                playerEl.className = 'player-item';
                playerEl.innerHTML = `
                    <div class="player-avatar-small">
                        ${player.name.charAt(0).toUpperCase()}
                    </div>
                    <div class="player-details">
                        <div class="player-name">${player.name}</div>
                        <div class="player-stake">Stake: ${player.stake} ·â•·à≠</div>
                    </div>
                `;
                elements.playersList.appendChild(playerEl);
            });
        }
        
        function generateBingoCard(gameType) {
            elements.bingoCard.innerHTML = '';
            
            // Create BINGO header
            const header = document.createElement('div');
            header.className = 'card-header';
            ['B', 'I', 'N', 'G', 'O'].forEach(letter => {
                const letterEl = document.createElement('div');
                letterEl.className = 'letter';
                letterEl.textContent = letter;
                header.appendChild(letterEl);
            });
            elements.bingoCard.appendChild(header);
            
            // Create 5x5 grid
            for (let row = 0; row < 5; row++) {
                const rowEl = document.createElement('div');
                rowEl.className = 'card-row';
                
                for (let col = 0; col < 5; col++) {
                    const cell = document.createElement('div');
                    cell.className = 'card-cell';
                    
                    // Center cell is FREE
                    if (row === 2 && col === 2) {
                        cell.textContent = 'FREE';
                        cell.classList.add('marked');
                    } else {
                        // Generate number based on column
                        const number = generateBingoNumber(col, row);
                        cell.textContent = number;
                        cell.dataset.number = number;
                        
                        cell.addEventListener('click', () => {
                            cell.classList.toggle('marked');
                            WebSocketModule.markNumber(number, cell.classList.contains('marked'));
                        });
                    }
                    
                    rowEl.appendChild(cell);
                }
                elements.bingoCard.appendChild(rowEl);
            }
        }
        
        function generateBingoNumber(col, row) {
            // B: 1-15, I: 16-30, N: 31-45, G: 46-60, O: 61-75
            const ranges = [
                { min: 1, max: 15 },
                { min: 16, max: 30 },
                { min: 31, max: 45 },
                { min: 46, max: 60 },
                { min: 61, max: 75 }
            ];
            
            const range = ranges[col];
            const numbersPerCol = 5;
            const number = range.min + (row * (range.max - range.min + 1) / numbersPerCol);
            return Math.floor(number);
        }
        
        function updateBingoCard(number) {
            const cells = elements.bingoCard.querySelectorAll('.card-cell[data-number]');
            cells.forEach(cell => {
                if (parseInt(cell.dataset.number) === number) {
                    cell.classList.add('called');
                }
            });
        }
        
        function addCalledNumber(number) {
            const numberEl = document.createElement('div');
            numberEl.className = 'called-number latest';
            numberEl.textContent = number;
            
            elements.calledNumbers.insertBefore(numberEl, elements.calledNumbers.firstChild);
            
            // Remove latest class from previous numbers
            setTimeout(() => {
                numberEl.classList.remove('latest');
            }, 1000);
            
            // Keep only last 25 numbers
            if (elements.calledNumbers.children.length > 25) {
                elements.calledNumbers.removeChild(elements.calledNumbers.lastChild);
            }
        }
        
        // Registration Functions
        function validateStep1() {
            const nameValid = elements.playerNameInput.value.length >= 2;
            const phoneValid = config.validatePhoneNumber(elements.playerPhoneInput.value);
            elements.nextStepBtn.disabled = !(nameValid && phoneValid);
        }
        
        function nextRegistrationStep() {
            if (gameState.currentStep === 1) {
                // Validate step 1
                if (!elements.playerNameInput.value || !elements.playerPhoneInput.value) {
                    showNotification('Please fill in all fields', 'error');
                    return;
                }
                
                gameState.currentStep = 2;
                updateRegistrationStep();
            } else if (gameState.currentStep === 2) {
                gameState.currentStep = 3;
                updateRegistrationStep();
                updateReviewInfo();
            }
        }
        
        function prevRegistrationStep() {
            if (gameState.currentStep > 1) {
                gameState.currentStep--;
                updateRegistrationStep();
            }
        }
        
        function updateRegistrationStep() {
            // Update step indicators
            [elements.step1, elements.step2, elements.step3].forEach((step, index) => {
                step.classList.remove('active', 'completed');
                if (index + 1 < gameState.currentStep) {
                    step.classList.add('completed');
                } else if (index + 1 === gameState.currentStep) {
                    step.classList.add('active');
                }
            });
            
            // Show/hide content
            [elements.step1Content, elements.step2Content, elements.step3Content].forEach((content, index) => {
                content.classList.toggle('hidden', index + 1 !== gameState.currentStep);
            });
            
            // Update buttons
            elements.prevStepBtn.style.display = gameState.currentStep > 1 ? 'block' : 'none';
            elements.nextStepBtn.style.display = gameState.currentStep < 3 ? 'block' : 'none';
            elements.submitRegistrationBtn.style.display = gameState.currentStep === 3 ? 'block' : 'none';
        }
        
        function updateReviewInfo() {
            elements.reviewName.textContent = elements.playerNameInput.value;
            elements.reviewPhone.textContent = elements.playerPhoneInput.value;
            elements.reviewGameType.textContent = elements.gameTypeSelect.options[elements.gameTypeSelect.selectedIndex].text;
            elements.reviewStake.textContent = elements.stakeSelect.value + ' ·â•·à≠';
            elements.reviewPayment.textContent = (elements.initialPayment.value || '0') + ' ·â•·à≠';
        }
        
        function submitRegistration(e) {
            e.preventDefault();
            
            if (!elements.termsCheckbox.checked) {
                showNotification('Please accept the terms and conditions', 'error');
                return;
            }
            
            const playerData = {
                name: elements.playerNameInput.value.trim(),
                phone: elements.playerPhoneInput.value.replace(/\D/g, ''),
                gameType: elements.gameTypeSelect.value,
                stake: parseInt(elements.stakeSelect.value),
                payment: parseInt(elements.initialPayment.value) || 0
            };
            
            WebSocketModule.registerPlayer(playerData);
        }
        
        // Game Functions
        function joinRoom() {
            const roomId = elements.roomIdInput.value.trim().toUpperCase();
            if (!roomId) {
                showNotification('Please enter a room ID', 'error');
                return;
            }
            
            if (!gameState.playerId) {
                showNotification('Please register first', 'error');
                openModal('registrationModal');
                return;
            }
            
            WebSocketModule.joinRoom(roomId);
            closeModal('joinRoomModal');
        }
        
        function createRoom() {
            const roomName = elements.newRoomName.value.trim() || `Room${Math.floor(Math.random() * 1000)}`;
            const gameType = elements.newGameType.value;
            const stake = parseInt(elements.newStakeAmount.value);
            
            // Generate room ID
            const roomId = roomName.replace(/\s+/g, '').toUpperCase().substring(0, 8) || 
                          'BINGO' + Math.floor(Math.random() * 100);
            
            // First join the room
            WebSocketModule.joinRoom(roomId);
            
            closeModal('createRoomModal');
            showNotification(`Created room: ${roomId}`, 'success');
        }
        
        function claimWin() {
            if (!gameState.roomId || !gameState.gameActive) {
                showNotification('Not in an active game', 'error');
                return;
            }
            
            // Show pattern selection
            const patterns = ['Full House', 'Line', 'Four Corners', 'X Pattern'];
            const pattern = patterns[0]; // In real implementation, let user choose
            
            WebSocketModule.claimWin(pattern, 0); // Amount calculated by server
        }
        
        function leaveRoom() {
            if (gameState.roomId) {
                WebSocketModule.leaveRoom();
                gameState.roomId = null;
                gameState.gameActive = false;
                
                elements.roomInfo.classList.add('hidden');
                elements.leaveRoomBtn.disabled = true;
                elements.claimWinBtn.disabled = true;
                
                // Reset bingo card
                elements.bingoCard.innerHTML = `
                    <div class="text-center" style="margin: auto; opacity: 0.7;">
                        <i class="fas fa-dice mb-20" style="font-size: 3rem;"></i>
                        <h3>Join a room to start playing!</h3>
                        <p>Select a game type and stake amount to begin.</p>
                    </div>
                `;
                
                showNotification('Left the room', 'info');
            }
        }
        
        function sendChatMessage() {
            const message = elements.chatInput.value.trim();
            if (!message) return;
            
            WebSocketModule.sendChat(message);
            elements.chatInput.value = '';
            
            // Add to chat display
            addChatMessage('You', message, false);
        }
        
        function addChatMessage(sender, text, isAdmin) {
            const messageEl = document.createElement('div');
            messageEl.className = 'chat-message' + (sender === gameState.playerName ? ' self' : '') + (isAdmin ? ' admin' : '');
            
            const senderSpan = document.createElement('span');
            senderSpan.style.fontWeight = 'bold';
            senderSpan.style.color = isAdmin ? '#FF9800' : '#4CAF50';
            senderSpan.textContent = sender + ': ';
            
            const textSpan = document.createElement('span');
            textSpan.textContent = text;
            
            messageEl.appendChild(senderSpan);
            messageEl.appendChild(textSpan);
            
            elements.chatMessages.appendChild(messageEl);
            elements.chatMessages.scrollTop = elements.chatMessages.scrollHeight;
        }
        
        // Admin Functions
        function showAdminStats() {
            WebSocketModule.adminGetStats();
        }
        
        function showAdminBroadcast() {
            const message = prompt('Enter broadcast message:');
            if (message) {
                WebSocketModule.adminBroadcast(message);
            }
        }
        
        function showAdminCallNumber() {
            const number = prompt('Enter number to call:');
            if (number && !isNaN(number)) {
                WebSocketModule.adminCallNumber(parseInt(number));
            }
        }
        
        function showSettings() {
            alert('Settings will be available soon!');
        }
        
        // Modal Functions
        function openModal(modalId) {
            document.getElementById(modalId).classList.add('active');
        }
        
        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }
        
        function closeAllModals() {
            document.querySelectorAll('.modal').forEach(modal => {
                modal.classList.remove('active');
            });
        }
        
        // Notification System
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            
            let icon = '‚ÑπÔ∏è';
            if (type === 'success') icon = '‚úÖ';
            else if (type === 'error') icon = '‚ùå';
            else if (type === 'warning') icon = '‚ö†Ô∏è';
            
            notification.innerHTML = `
                <span class="notification-icon">${icon}</span>
                <span class="notification-text">${message}</span>
                <button class="notification-close">&times;</button>
            `;
            
            notification.querySelector('.notification-close').onclick = () => {
                notification.remove();
            };
            
            elements.notifications.appendChild(notification);
            
            // Auto remove after 5 seconds
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.remove();
                }
            }, 5000);
        }
        
        function updateLoadingMessage(message) {
            document.getElementById('loadingMessage').textContent = message;
        }
        
        // Service Worker Registration (for PWA)
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js').then(
                    registration => {
                        console.log('ServiceWorker registration successful');
                    },
                    error => {
                        console.log('ServiceWorker registration failed: ', error);
                    }
                );
            });
        }
        
        // Handle offline/online status
        window.addEventListener('online', () => {
            showNotification('Back online. Reconnecting...', 'info');
            WebSocketModule.reconnect();
        });
        
        window.addEventListener('offline', () => {
            showNotification('You are offline. Please check your connection.', 'error');
        });
        
        // Prevent accidental refresh
        window.addEventListener('beforeunload', (e) => {
            if (gameState.roomId && gameState.gameActive) {
                e.preventDefault();
                e.returnValue = 'Are you sure you want to leave? Your game progress may be lost.';
            }
        });
        
        // Initialize when DOM is loaded
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initApp);
        } else {
            initApp();
        }
        
        // Make functions available globally for inline event handlers
        window.closeModal = closeModal;
        window.openModal = openModal;
        
        console.log('üì± Bingo Game Frontend Loaded');
        console.log('üîß Configuration:', config.getBackendConfig());
    </script>
    
    <!-- PWA Service Worker (optional) -->
    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js').catch(error => {
                console.log('Service Worker registration failed:', error);
            });
        }
    </script>
</body>
</html>
